# crypto2 (Easy)
## Đề bài
- Source code `chall.py`:
``` Python
from Crypto.Util.number import *

 
with open("flag.txt", "r") as f:
    flag = f.read().strip()
p = getPrime(1024)
q = getPrime(1024)
r = getPrime(1024)
n = p * q
phi = (p - 1) * (q - 1)
e = 65537
d = pow(e, -1, phi)


message = input("Enter text to encrypt: ")
m = bytes_to_long(message.encode())
c = pow(m, e, n)                                      
print(f"Here is your encrypted message: {c}")
print("Here is the public key for your reference:")
print(f"n = {n}")
print(f"e = {e}")


m = bytes_to_long(flag.encode())
n = p*r
c = pow(m, e, n)
print(f"Here is the encrypted flag: {c}")
print("Here is the public key for your reference:")
print(f"n = {n}")
```
## Solution
- Dựa vào đề bài và đoạn code được cho, ta dễ dàng thấy rằng flag đã được mã hóa bằng thuật toán `RSA`
- Mở kali và `nc 14.225.255.41 1337`, ta thấy đề bài yêu cầu nhập dữ liệu để mã hóa. Nhập bất kì dữ liệu nào đó, ta thu được các thông số:
![alt text](https://github.com/nhh9905/CTF/blob/main/PTITCTF%202024/V%C3%B2ng%20lo%E1%BA%A1i/Crypto/image-1.png)
```
Here is your encrypted message: 2706228352686041147747063639459233221330855364297572737144302557884630244805622490450555009621106917287379101917187963429139815743117103157659660395364940415288290325819609298541786814724229484241740461159529739896168986333756969793543259807244065441429037332712128832124366980497035017379163758728121770169976744704951244747843370430935866964319047702269296226509552186330309385163638387211716301443072292460055772600840568535370160019239628820369182738289072873625794281586761929441420508413107013621209227226561712400198517361298091569795480745364989403100228761120372744355555856945758536174515353166649752653526
Here is the public key for your reference:
n = 10424191014091018416990959230285518431315141115057392613294664689420512893658516808689808005912718869388320008932704250323170794311764424980782486913249094891880527551610441092987870116301999193910659014350167451250566195749432623824212265449437301129183905283910937216625774181081371171678923511586521236420697962465077454177824746099897991943845695357381277007588369833726772171886124597232238115628669796306850525520082716152647830005110181306867595738534058770303345753152003653204558324490122451459667229256377415504359737107046424074825410896486989150734658785348076905811549363526379787073237234777799258561227
e = 65537
Here is the encrypted flag: 15239375123537422758698727855580265152179341727389553971453425838351820086417770778622943509970318400322898143340767728554573627367334890829581165203005866171925635992047976260348103132377084135258999259959882522844853240784577945410117026426181559080605606220988403086215765536730312553402512722362164693529342876405804564159437318183521588466874955569372283691173503736255870718881953551479479591935386789655273140338245549822360465822841687759306996826602759886315650374644787718748656132825728735722136261367034811914416853589083393743412332229016779670304097315569750585036839512051831391531297341958635033170347
Here is the public key for your reference:
n = 15959220675173826800869626856920310216573319873154807951117617752326495731715332162348530366493028062787897684737979286624196305555272406018050791872143575368387686920444063802878309002969299806753255377896334417638349355215938036916654135508723650551126856469949857798642049508326618021925278605584363739755861042459128437495570929314459974465732236088407487956780511640161098381624825391802177288111932982291136185036079930475223887157370521631024988655932708540865449737573954876595781335472291981786931916951393039694413580707829970513257993020150631286493828174291490684310999570527877870326938123695122927939091
```
- Chúng ta thu được văn bãn đã được mã hóa, public key của dữ liệu vừa nhập vào và flag
- Viết code tìm d để lấy được private key:
```Python
from math import gcd
n1 = 10424191014091018416990959230285518431315141115057392613294664689420512893658516808689808005912718869388320008932704250323170794311764424980782486913249094891880527551610441092987870116301999193910659014350167451250566195749432623824212265449437301129183905283910937216625774181081371171678923511586521236420697962465077454177824746099897991943845695357381277007588369833726772171886124597232238115628669796306850525520082716152647830005110181306867595738534058770303345753152003653204558324490122451459667229256377415504359737107046424074825410896486989150734658785348076905811549363526379787073237234777799258561227
n2 = 15959220675173826800869626856920310216573319873154807951117617752326495731715332162348530366493028062787897684737979286624196305555272406018050791872143575368387686920444063802878309002969299806753255377896334417638349355215938036916654135508723650551126856469949857798642049508326618021925278605584363739755861042459128437495570929314459974465732236088407487956780511640161098381624825391802177288111932982291136185036079930475223887157370521631024988655932708540865449737573954876595781335472291981786931916951393039694413580707829970513257993020150631286493828174291490684310999570527877870326938123695122927939091
p = gcd(n1, n2)
q = n1//p
r = n2//p
n = n2
phi = (p - 1)*(r - 1)
e = 65537
d = pow(e, -1, phi)
print("d =", d)
```
- Sau khi tìm được d, ta lên web `dcode.fr` nhập 4 đầu vào dữ liệu C, N, E, D và thu được flag
![alt text](https://github.com/nhh9905/CTF/blob/main/PTITCTF%202024/V%C3%B2ng%20lo%E1%BA%A1i/Crypto/image-2.png)
## Flag
``` PTITCTF{y0u_kn0w_4tt4ck1ng_rs4} ```
